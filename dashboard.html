<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AdMan – Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Lora:wght@400;600&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar"><div class="wrap"><div class="brand"><span class="dot"></span> AdMan</div><div style="display:flex;align-items:center;gap:10px"><span id="userEmail"></span><button class="btn ghost" id="logoutBtn">Sign out</button></div></div></header>
<div class="layout">
<aside class="sidebar"><nav class="nav">
  <a href="dashboard.html">Dashboard</a>
  <a href="banners.html">Banner Editor</a>
  <a href="emails.html">Email Editor</a>
  <a href="landings.html">Landing Editor</a>
  <a href="settings.html">Settings</a>
</nav></aside>
<main class="main">
  <h1 style="margin-top:0">Dashboard</h1>
  <div class="kpi">
    <div class="tile"><div style="color:var(--sub);font-size:13px">Banners</div><div id="kpiBanners" style="font:800 28px var(--font-display)">0</div></div>
    <div class="tile"><div style="color:var(--sub);font-size:13px">Email templates</div><div id="kpiEmails" style="font:800 28px var(--font-display)">0</div></div>
    <div class="tile"><div style="color:var(--sub);font-size:13px">Landing pages</div><div id="kpiLandings" style="font:800 28px var(--font-display)">0</div></div>
  </div>

  <div class="card" style="margin-top:16px;padding:18px">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font:700 18px var(--font-display);margin-bottom:4px">Active Campaign</div>
        <div id="activeCampaignText" style="color:var(--sub)">No active campaign. Create one from the editors.</div>
      </div>
      <div style="display:flex;gap:10px">
        <a class="btn primary" href="banners.html">New Banner</a>
        <a class="btn" href="emails.html">New Email</a>
        <a class="btn" href="landings.html">New Landing</a>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:16px;padding:18px">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font:700 18px var(--font-display);margin-bottom:4px">Your items</div>
        <div style="color:var(--sub)">Recent saved banners, emails and landings.</div>
      </div>
    </div>
    <div id="gallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;margin-top:14px"></div>
  </div>
</main>
</div>
<div class="toast"></div>
<script type="module">
import { authGate, initTopbar, wireSidebarActive } from './app.js';
import { getStore } from './storage.js';

authGate(); initTopbar(); wireSidebarActive();

const banners = getStore('adman.banners', []);
const emails = getStore('adman.emails', []);
const landings = getStore('adman.landings', []);

document.querySelector('#kpiBanners').textContent = banners.length;
document.querySelector('#kpiEmails').textContent = emails.length;
document.querySelector('#kpiLandings').textContent = landings.length;

const active = getStore('adman.activeCampaign', null);
const actText = document.querySelector('#activeCampaignText');
if(active){ actText.textContent = `${active.type} • ${active.title} • since ${new Date(active.since).toLocaleDateString()}`; }

function card(item){
  const d = document.createElement('div');
  d.className='card'; d.style.padding='12px';
  d.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
  <div>
    <div style="font-weight:700">${item.title||item.name||'(untitled)'} <span style="opacity:.6;font-size:12px">${item.kind}</span></div>
    <div style="color:var(--sub);font-size:12px">${new Date(item.updated||Date.now()).toLocaleString()}</div>
  </div>
  <a class="btn ghost" href="${item.href}">Open</a>
  </div>`;
  return d;
}

const gallery = document.querySelector('#gallery');
[...banners.map(b=>({kind:'Banner', title:b.text||b.title, updated:b.updated, href:'banners.html'})),
 ...emails.map(e=>({kind:'Email', title:e.title, updated:e.updated, href:'emails.html'})),
 ...landings.map(l=>({kind:'Landing', title:l.title, updated:l.updated, href:'landings.html'}))]
 .slice(0,9).forEach(x=>gallery.appendChild(card(x)));
</script>
</body></html>