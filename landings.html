<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AdMan – Landing Editor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Lora:wght@400;600&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar"><div class="wrap"><div class="brand"><span class="dot"></span> AdMan</div><div style="display:flex;align-items:center;gap:10px"><span id="userEmail"></span><button class="btn ghost" id="logoutBtn">Sign out</button></div></div></header>
<div class="layout">
<aside class="sidebar"><nav class="nav">
  <a href="dashboard.html">Dashboard</a>
  <a href="banners.html">Banner Editor</a>
  <a href="emails.html">Email Editor</a>
  <a href="landings.html">Landing Editor</a>
  <a href="settings.html">Settings</a>
</nav></aside>
<main class="main">
  <h1 style="margin-top:0">Landing Editor</h1>
  <div class="row cols-2">
    <div class="card" style="padding:16px">
      <label class="label">Template</label>
      <select class="input" id="template">
        <option value="lead">Lead capture</option>
        <option value="product">Product promo</option>
        <option value="event">Event</option>
      </select>
      <label class="label">Title</label><input id="title" class="input" placeholder="Grow your business"/>
      <label class="label">Subtitle</label><input id="subtitle" class="input" placeholder="Short value proposition"/>
      <label class="label">Hero image URL</label><input id="hero" class="input" placeholder="https://..."/>
      <div class="row cols-2">
        <div><label class="label">CTA label</label><input id="ctaLabel" class="input" placeholder="Get started"></div>
        <div><label class="label">CTA URL</label><input id="ctaUrl" class="input" placeholder="#"></div>
      </div>
      <div class="row cols-3" style="margin-top:10px">
        <div><label class="label">BG</label><input type="color" id="bg" class="input" value="#ffffff"></div>
        <div><label class="label">Text</label><input type="color" id="fg" class="input" value="#111827"></div>
        <div><label class="label">Font</label>
          <select class="input" id="font"><option>Inter</option><option>Lora</option><option>Montserrat</option></select>
        </div>
      </div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button class="btn primary" id="save">Save</button>
        <button class="btn" id="download">Download HTML</button>
      </div>
    </div>

    <div class="card" style="padding:16px">
      <div class="label">Live preview</div>
      <iframe id="preview" style="width:100%;min-height:560px;background:white;border-radius:12px;border:1px solid #e5e7eb"></iframe>
    </div>
  </div>

  <div class="card" style="padding:16px;margin-top:16px">
    <div style="display:flex;align-items:center;justify-content:space-between"><div>Saved landings</div><button class="btn ghost" id="refresh">Refresh</button></div>
    <div id="list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:12px"></div>
  </div>
</main>
</div>
<div class="toast"></div>
<script type="module">
import { authGate, initTopbar, wireSidebarActive, toast, enableCtrlS } from './app.js';
import { getStore, setStore, uid, nowISO } from './storage.js';

authGate(); initTopbar(); wireSidebarActive();

const state={template:'lead',title:'Grow your business',subtitle:'Short value proposition',hero:'',ctaLabel:'Get started',ctaUrl:'#',bg:'#ffffff',fg:'#111827',font:'Inter'};
const el={ template:$('#template'), title:$('#title'), subtitle:$('#subtitle'), hero:$('#hero'), ctaLabel:$('#ctaLabel'), ctaUrl:$('#ctaUrl'), bg:$('#bg'), fg:$('#fg'), font:$('#font'), iframe:$('#preview'), list:$('#list') };
function $(s){ return document.querySelector(s); }

const tpl={
  lead:(s)=>`<!doctype html><meta charset='utf-8'><style>body{margin:0;background:${s.bg};color:${s.fg};font-family:${s.font},Arial,sans-serif} .wrap{max-width:900px;margin:0 auto;padding:32px} .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:22px;align-items:center} img{max-width:100%;border-radius:12px} .btn{display:inline-block;background:#3b82f6;color:#fff;padding:12px 16px;border-radius:12px;text-decoration:none}</style><div class='wrap'><div class='hero'><div><h1 style='margin:0 0 8px;font-weight:800'>${s.title}</h1><p style='opacity:.8;margin:0 0 16px'>${s.subtitle}</p><a class='btn' href='${s.ctaUrl}'>${s.ctaLabel}</a></div><div>${s.hero?`<img src='${s.hero}'>`:''}</div></div><form onsubmit="event.preventDefault();alert('Saved locally');" style='margin-top:20px'><input style='padding:10px;border-radius:10px;border:1px solid #ddd;margin-right:8px' placeholder='Name'><input style='padding:10px;border-radius:10px;border:1px solid #ddd;margin-right:8px' placeholder='Email'><button class='btn' type='submit'>Submit</button></form></div>`,
  product:(s)=>`<!doctype html><meta charset='utf-8'><style>body{margin:0;background:${s.bg};color:${s.fg};font-family:${s.font},Arial,sans-serif} .wrap{max-width:900px;margin:0 auto;padding:32px;text-align:center} .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin:18px 0} img{max-width:100%;border-radius:12px} .btn{display:inline-block;background:#10b981;color:#0b0b0b;padding:12px 16px;border-radius:12px;text-decoration:none}</style><div class='wrap'><h1 style='margin:0 0 8px;font-weight:800'>${s.title}</h1><p style='opacity:.8;margin:0 0 16px'>${s.subtitle}</p><div class='grid'>${[1,2,3].map(i=>`<img src='${s.hero||`https://via.placeholder.com/280x180?text=Image+${i}`}'/>`).join('')}</div><a class='btn' href='${s.ctaUrl}'>${s.ctaLabel}</a></div>`,
  event:(s)=>`<!doctype html><meta charset='utf-8'><style>body{margin:0;background:${s.bg};color:${s.fg};font-family:${s.font},Arial,sans-serif} .wrap{max-width:900px;margin:0 auto;padding:32px} .agenda{margin-top:16px;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden} .row{display:grid;grid-template-columns:140px 1fr} .row>div{padding:12px;border-bottom:1px solid #e5e7eb} .btn{display:inline-block;background:#111827;color:#fff;padding:12px 16px;border-radius:12px;text-decoration:none}</style><div class='wrap'><h1 style='margin:0 0 8px;font-weight:800'>${s.title}</h1><p style='opacity:.8;margin:0 0 16px'>${s.subtitle}</p><div class='agenda'>${['09:00 Opening','10:00 Keynote','11:00 Panel','12:30 Lunch'].map(x=>`<div class='row'><div>${x.split(' ')[0]}</div><div>${x.slice(6)}</div></div>`).join('')}</div><a class='btn' href='${s.ctaUrl}' style='margin-top:16px;display:inline-block'>${s.ctaLabel}</a></div>`
};

function render(){ const doc = el.iframe.contentDocument; doc.open(); doc.write(tpl[state.template](state)); doc.close(); }
['template','title','subtitle','hero','ctaLabel','ctaUrl','bg','fg','font'].forEach(k=>{ document.querySelector('#'+k).addEventListener('input',e=>{ state[k]=e.target.value; render(); })});
render();

document.querySelector('#download').addEventListener('click',()=>{
  const html = tpl[state.template](state);
  const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([html],{type:'text/html'})); a.download='landing.html'; a.click();
});

document.querySelector('#save').addEventListener('click',()=>{
  const list = getStore('adman.landings', []);
  list.unshift({ id:uid('lp'), ...state, updated: nowISO() });
  setStore('adman.landings', list); toast('Landing saved'); loadList();
});

function loadList(){
  el.list.innerHTML='';
  const items = getStore('adman.landings', []);
  items.forEach(it=>{
    const c=document.createElement('div'); c.className='card'; c.style.padding='10px';
    c.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
      <div><div style="font-weight:700">${it.title}</div><div style="color:var(--sub);font-size:12px">${it.template} • ${new Date(it.updated).toLocaleString()}</div></div>
      <button class="btn ghost" data-id="${it.id}">Activate</button>
    </div>`;
    c.querySelector('button').addEventListener('click',()=>{
      localStorage.setItem('adman.activeCampaign', JSON.stringify({type:'Landing', title: it.title, since: Date.now()}));
      alert('Active campaign set');
    })
    el.list.appendChild(c);
  })
}

document.querySelector('#refresh').addEventListener('click', loadList);
loadList();

enableCtrlS(()=>document.querySelector('#save').click());
</script>
</body></html>